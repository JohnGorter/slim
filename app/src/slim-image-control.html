<dom-module id="slim-image-control">
    <template>
  ahaaaa

     <!-- hidden canvas for image manipulation -->
            <canvas id="canvas" hidden width="0" height="0" style="border:2px solid red;z-index:110;">hier</canvas> 


        <!-- image manipulation toolbar -->
        <paper-toolbar width="100%">
            <paper-icon-button on-tap="_takepicture" slot="top"   icon="image:camera-alt">Bewaar foto</paper-icon-button>
            <div slot="top" class="title">Maak foto</div>
            <paper-icon-button slot="top" icon="undo" on-tap="_undo"></paper-icon-button>
            <paper-icon-button slot="top" icon="image:rotate-90-degrees-ccw" on-tap="_rotate"></paper-icon-button>
            <paper-icon-button slot="top" icon="invert-colors" on-tap="_grayscale"></paper-icon-button>
            <paper-icon-button slot="top" icon="delete" on-tap="_deleteConfirm"></paper-icon-button>
             <paper-icon-button on-tap="_save"  slot="top" icon="save">Foto toevoegen</paper-icon-button>
        </paper-toolbar>

         

    </template>
    <script>
    Polymer({
      is:'slim-image-control',
      properties:{
         photo:{
            type:String,
            notify:true
        }
      },
       _grayscale()
        {
            var myCanvasContext = this.$.canvas.getContext("2d");
            var img = new Image();
            img.onload = () => {
                var imgWidth=img.width;
                var imgHeight=img.height;
                // You'll get some string error if you fail to specify the dimensions
                this.$.canvas.width= imgWidth;
                this.$.canvas.height=imgHeight;
                //  alert(imgWidth);
                myCanvasContext.drawImage(img,0,0);

                // This function cannot be called if the image is not rom the same domain.
                // You'll get security error if you do.
                var imageData=myCanvasContext.getImageData(0,0, imgWidth, imgHeight);

                // This loop gets every pixels on the image and
               for (var i = 0; i < imageData.data.length; i+=4) {
                    var redPx = imageData.data[i];
                    var greenPx = imageData.data[i+1];
                    var bluePx = imageData.data[i+2];
                    var alphaPx = imageData.data[i+3];

                    var greyScale = redPx * .3 + greenPx * .59 + bluePx * .11;

                    imageData.data[i] = greyScale;
                    imageData.data[i+1] = greyScale;
                    imageData.data[i+2] = greyScale;
                    imageData.data[i+3] = alphaPx;
                }

                myCanvasContext.putImageData(imageData, 0,0);
                this._save();
            }
            img.src = this.photo;
        },

        _rotate(){
            // ang = 90; 
            // if (ang >= 360) ang = 0;

            var ctx = this.$.canvas.getContext('2d');
            var img = new Image();

            var fps = 1000 / 25; //number of frames per sec
            img.onload = function () { //on image load do the following stuff
                var width = this.$.canvas.width == 0 ? img.width : this.$.canvas.width;
                var height = this.$.canvas.height == 0 ? img.height: this.$.canvas.height;
                console.log('img is ', width, height);
                this.$.canvas.width = height;
                this.$.canvas.height = width;
                console.log('setting canvas to ', this.$.canvas.width, this.$.canvas.height);
                ctx.save(); //saves the state of canvas
                ctx.clearRect(0, 0, this.$.canvas.width, this.$.canvas.height); //clear the canvas
                ctx.translate(this.$.canvas.width/2, this.$.canvas.height/2,); //let's translate
                ctx.rotate(Math.PI / 180 * (ang)); //increment the angle and rotate the image 
                ctx.drawImage(img,-img.width/2,-img.height/2, img.width, img.height);
                ctx.restore(); //restore the state of canvas
                this._save();
            }.bind(this);
            img.src = this.photo;
        },
        _save(){
            this.set('photo', this.$.canvas.toDataURL());
        },
    })
    </script>
</dom-module>