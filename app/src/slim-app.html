<link rel="import" href="../bower_components/polymer/polymer.html" />
<link rel="import" href="../bower_components/app-layout/app-layout.html" />
<link rel="import" href="../bower_components/paper-button/paper-button.html" />
<link rel="import" href="../bower_components/paper-card/paper-card.html" />
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html" />
<link rel="import" href="../bower_components/paper-item/paper-item.html" />
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html" />
<link rel="import" href="../bower_components/iron-icon/iron-icon.html" />
<link rel="import" href="../bower_components/iron-icons/iron-icons.html" />
<link rel="import" href="../bower_components/iron-icons/image-icons.html" />
<link rel="import" href="../bower_components/paper-toolbar/paper-toolbar.html" />
<link rel="import" href="../bower_components/paper-input/paper-input.html" />
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html" />
<link rel="import" href="../bower_components/iron-list/iron-list.html" />
<link rel="import" href="../bower_components/iron-media-query/iron-media-query.html" />
<link rel="import" href="../bower_components/polymerfire/polymerfire.html" />
<link rel="import" href="../bower_components/slate-font-awesome/slate-font-awesome.html">

<link rel="import" href="./firebase-storage.html" />
<link rel="import" href="./slim-footer.html" />
<link rel="import" href="./slim-overlay.html" />
<link rel="import" href="./slim-theme.html" />
<link rel="import" href="./slim-category-data.html" />
<link rel="import" href="./slim-photo-page.html" />
<link rel="import" href="./slim-image-control.html" />
<link rel="import" href="./slim-image-caroussel.html" />

<dom-module id="slim-app">
    <template>
        <style include="slim-theme">
           

            .contact { align-self:center;display:flex;align-items:center;justify-content:center;background-color:#e0d405;border-radius:50%;width:100px;height:100px;}
            .contact-inner { display:flex;align-items:center;justify-content:center;background-color:#303030;border-radius:50%;width:90%;height:90%;}
            .main-screen { display:flex;align-items:flex-start;background:url('../images/bg.jpg') center center;justify-content:center;bottom:0px;height:100vh;width:100vw;margin-top:50px;}
            .footer ul { margin-top:60px;font-size:14px;margin-left:0px;}
            li { list-style: none;margin:15px;list-style-position:unset}
        </style>

   <app-header fixed condenses effects="waterfall">
        <app-toolbar sticky$="[[_shouldStick(smallscreen)]]" class="toolbar"   >
            <paper-icon-button icon="menu" class="menu-btn" on-tap="toggle"></paper-icon-button>
            <div main-title style="display:flex;align-items:center;flex-direction:column;">
                <img class="navbar-logo" src="../images/logo.svg"/>  
            </div> 
              <template is="dom-if" if="{{user.email}}">
            <paper-icon-button icon="lock-outline" class="menu-btn" on-tap="signout"></paper-icon-button>
              </template>
                <template is="dom-if" if="{{!user.email}}">
            <paper-icon-button icon="account-circle" class="menu-btn" on-tap="signin"></paper-icon-button>
              </template>
        </app-toolbar>
        <div sticky$="[[!_shouldStick(smallscreen)]]" hidden$="{{smallscreen}}">
                <section id="navbar">
                    <div class="navbar-logo"><img class="full-height" src="../images/logo.svg">
                     </div>
            <div class="navbar-menu">
                    <ul>
                        <template is="dom-repeat" items="{{categories}}">
                            <li on-tap="navigateTo">{{item}}</li>
                        </template>
                    </ul>
                 </div>
    </section>

        </div>
    </app-header>
    <app-drawer id="drawer" swipe-open$="[[smallscreen]]" style="z-index:60;">
         <app-toolbar style="height:180px;">
             <div style="width:100vw;display:flex;align-items:center;justify-content:center;">
            <div main-title class="contact">
                  <div class="contact-inner">
                        <img class="navbar-logo small" src="../images/logo.svg"/>
                  </div>
            </div>
                </div>
        </app-toolbar>
        
        <paper-listbox selected="{{selectedpage}}">
            <paper-item>Home</paper-item>
            <paper-item>Diensten</paper-item>
            <paper-item>Tarieven</paper-item>
            <paper-item>Portfolio</paper-item>
            <template is="dom-if" if="{{userprofile.isAdmin}}">
                 <paper-item>Maak foto</paper-item>
            </template>
        </paper-listbox>
        <div class="footer">
            <ul>
                <li>Gerald van Dongen</li>
                <li>+31 (0)6 101 517 41</li>
                <li>info@s-l-i-m.nl</li>
            </ul>
        </div>
    </app-drawer>

 
    
    <template is="dom-if" if="{{smallscreen}}"><br/>
        <div class="main-screen">
            <firebase-storage></firebase-storage>
            <slim-mobile-pages 
                    selectedpage="{{selectedpage}}" 
                    userprofile="{{userprofile}}" 
                    on-photo-delete="_delete" on-photo-save="_save" on-photo-taken="_addPhoto" key="$key"
                    portfolio="{{portfolio}}"><img style="height:50px" src="./images/loading.svg"/>
            </slim-mobile-pages>
            <slim-overlay src="/images/header-splatters.svg"></slim-overlay>
        </div>
        </template>

    <template is="dom-if" if="{{!smallscreen}}"><br/><br/><br/><br/>
        <slim-desktop-pages id="desktopPages">loading...</slim-desktop-pages>
    </template>

    

        <!-- non visual components -->
        <slim-category-data categories="{{categories}}" on-categories-changed="log">data </slim-category-data>

        <iron-media-query query="max-width: 767px" query-matches="{{smallscreen}}"></iron-media-query>
        <firebase-app
            name="slimapp"
            api-key="AIzaSyAIrU1xKfGnsX2Pa40idv-9uGLnomiMyp4"
            auth-domain="rep-app-dcb15.firebaseapp.com"
            database-url="https://rep-app-dcb15.firebaseio.com"
            project-id="rep-app-dcb15">
        </firebase-app>
        <firebase-auth id="login" provider="google" app-name="slimapp" user="{{user}}"> </fireabse-auth>
        <firebase-document app-name="slimapp" data="{{userprofile}}" path="/users/{{user.uid}}"></firebase-document>
        <firebase-query app-name="slimapp" path="/photos" data="{{portfolio}}" id="fbquery"></firebase-query>
        <firebase-document id="fbdoc" path="/photos/{{selectedPhotoId}}" data="{{selectedPhoto}}" app-name="slimapp"></firebase-document>

       

    </template>
    <script>
       // window.addEventListener('webcomponentsReady', function(){
            Polymer({ 
            is:'slim-app', 
            observers:['_loadScreenComponent(smallscreen)', '_pageChanged(selectedpage)'],
            properties:{
                selectedpage:{
                    type:Number,
                    value:0
                },
                user:{
                    type:Object,
                    value:{}
                },
                userprofile:{
                    type:Object, 
                    value: { isAdmin:false}
                }
            },
            _addPhoto() {
                this.$.fbquery.ref.push({ photo: event.detail.photo, title: event.detail.title });
                this.selectedpage = 3;
            },
            _save(){
              this.selectedPhotoId = event.detail.key;
              this.set('selectedPhoto.photo',  event.detail.photo);
            },
            _delete() {
                this.selectedPhotoId = event.detail.key;
                this.selectedPhoto = null;
                this.$.fbdoc.saveValue('/photos', this.selectedPhotoId);
            },
            signin(){
                //this.set('userprofile.isAdmin',true);
                this.$.login.signInWithPopup();
            },
            signout(){
                if (this.$.login.signedIn) {
                    this.$.login.signOut();
                }
            },
            navigateTo(){
                this.$$("#desktopPages").scrollTo(event.model.item.toLowerCase());
            },
            toggle(){ this.$.drawer.toggle()},
            _pageChanged(){
                this.$.drawer.close();
            },
            _shouldStick(small){ return small; },
            _loadScreenComponent(){
                var component = this.smallscreen ? 'slim-mobile-pages.html' : 'slim-desktop-pages.html';
                this.importHref(this.resolveUrl(component));
            }
        });
       // });
        
    </script>
</dom-module>